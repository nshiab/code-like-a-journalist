---
title: How to analysize tabular data with the simple-data-analysis library
description: In this lesson, we learn how to use SDA by crunching daily temperature data.
---

import { Callout } from 'nextra/components'
import { NoticeIntro, NoticeEnd } from "../../../components/Notices.jsx"

# The Simple Data Analysis library

In this lesson, we will learn how to use the open-source library I created: [simple-data-analysis](https://github.com/nshiab/simple-data-analysis). We will analyze historical daily average temperature data in three Canadian cities as an example. Our goal will be to answer this question:

- How fast have the temperture risen in the past decades?

To do that, we will calculate the average temperature per 30-year period and check for trends.

If you have a minute, please add a ⭐ to the library [GitHub repository](https://github.com/nshiab/simple-data-analysis). It's always nice to know your open-source work is appreciated. 😊

Note that I am expecting you have at least completed the **First steps 🧑‍🎓** and **Pushing further 🚀** sections.

<NoticeIntro />

## Setup

The library is published on [JSR](https://jsr.io/@nshiab/simple-data-analysis) and you could install it by running `deno add @nshiab/simple-data-analysis`.

But there's a better way. 😏

Create a new folder on your computer and run this instead:
`deno -A jsr:@nshiab/setup-sda`

This tells Deno to run the another library called [setup-sda](https://jsr.io/@nshiab/setup-sda), which I created too to easily install and setup everything I need when starting a new data analysis.

Here's what you should see in VS Code.

In your terminal, you have a description of the files that have been created and the libraries that have been installed.

![A screenshot showing VS Code after running setup-sda.](/assets/simple-data-analysis/tabular-data/setup.png)

Here are the files:

- `deno.json`: if you click on it, you'll see two taks. We will use `sda` to watch, check and run `sda/main.ts` You can also see three libraries. More about it below.
- `.gitignore`: this is an important file when using `git` to save our code. Don't worry about it for now. There will be a full lesson about it.
- `sda/main.ts`: this is the main file of our script. We will code in it.
- `sda/helpers`: it's an empty folder for now, but we will put our functions in it.
- `sda/data`: it's an empty folder for now, but this is where we will put our data to be crunched.
- `sda/output`: it's an empty folder for now. This is where will write our results into files.
- `README.md`: it's a text file with some information about the project.

And here are three libraries installed:
- [`simple-data-analysis`](https://github.com/nshiab/simple-data-analysis): it's the library we will use to crunch the data.
- [`journalism`](https://github.com/nshiab/journalism): it's another library I created. It's a collection of useful functions to do all kind of things, like formatting dates or pushing data to Google Sheets.
- [`@observablehq/plot`](https://github.com/observablehq/plot): It's a library created by Mike Bostock (creator of d3.js) that we will use to create charts and maps.

Now that you know what's in your folder, let's start working. Run the suggested task to run and watch our code: `deno task sda`

## Creating a table

Let me explain the current code in `main.ts`.

When you use SDA, you create an **in-memory database**. This is what is happening on line 3 with `new SimpleDB()`. When we are done with our computations, we close the DB on line 7.

```ts showLineNumbers filename="main.ts"
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB();

// Do your magic here!

await sdb.done();
```

As in a regular database, with SimpleDB, data is stored into **tables**. If you are more familiar with Excel or Google Sheets, tables can be understood are tabs.

Let's create one to store daily temperatures.

To create a table, you can use the `.newTable()` method. You can give it a name (but it's optional) and store the table in a variable. Usually, I name the variable and the table the same thing.

```ts showLineNumbers filename="main.ts" {5}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB();

const temperatures = sdb.newTable("temperatures");

await sdb.done();
```

Now that we have a table, we can use tables' methods! On another line, type the variable `temperature` and add a `.` immediately after it to see all the methods available. You can use your up and down keyboard arrow to check their documentation and examples. There's a lot!

In the screenshot below, I stopped on `loadData`, which the method we are going to use in a minute.

![A screenshot showing VS Code documentation for loadData.](/assets/simple-data-analysis/tabular-data/load-data-doc.png)

## Loading data

I uploaded to GitHub the historical daily temperatures for three Canadian cities. It's a CSV file that [you can see here](https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv). It comes from the [Adjusted and homogenized Canadian climate data](https://www.canada.ca/en/environment-climate-change/services/climate-change/science-research-data/climate-trends-variability/adjusted-homogenized-canadian-data.html) from Environment Canada.

Let's use the `loadData` method to retrieve it. Note that the method is able to fetch remote files but also to read local files. It can parse CSV, JSON, Excel, and Parquet files. Quite handy!

It would be nice to see the data once loaded. We can do that by calling the `logTable` method.

All tables' methods are `async`, so we need to specify `await` in front of them.

```ts showLineNumbers filename="main.ts" {7-9, 11}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB();

const temperatures = sdb.newTable("temperatures");

await temperatures.loadData(
  "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
);

await temperatures.logTable();

await sdb.done();
```

And here's the result! We can see the CSV data has been ingested into the table `temperature` which now has three columns and 131k rows.

![A screenshot showing temperature data logged in the terminal.](/assets/simple-data-analysis/tabular-data/data-loaded.png)

## Joining data

It would be better to replace the ids by the cities names. The ids and the city names are in another file that [I uploaded on GitHub too](https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv).

Let's fetch it too.

```ts showLineNumbers filename="main.ts" {11-15}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB();

const temperatures = sdb.newTable("temperatures");
await temperatures.loadData(
  "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
);
await temperatures.logTable();

const cities = sdb.newTable("cities");
await cities.loadData(
  "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
);
await cities.logTable();

await sdb.done();
```

![A screenshot showing the cities names in the terminal.](/assets/simple-data-analysis/tabular-data/cities-loaded.png)

Now, we want to bring the cities names into the the `temperatures` table. To do that, we can use the `.join()` method.

By default, this methods will look for a common column in two tables and will match rows based on the values in this column.

So, when we write `await temperature.join(cities)`, we ask SDA to find a common column in `temperatures` and `cities` (which is `id`) and to add to the `temperature` rows the `cities` values with the same `id`.

```ts showLineNumbers filename="main.ts" {9, 15, 17-18}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB();

const temperatures = sdb.newTable("temperatures");
await temperatures.loadData(
  "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
);
// await temperatures.logTable();

const cities = sdb.newTable("cities");
await cities.loadData(
  "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
);
// await cities.logTable();

await temperatures.join(cities);
await temperatures.logTable();

await sdb.done();
```

And now we have the cities names into the `temperatures` table!

![A screenshot showing the cities names in the temperatures table.](/assets/simple-data-analysis/tabular-data/join.png)

## Caching

Curently, everytime we save `main.ts`, the two CSV files are being refetched. It's slow and unecessary since the data doesn't change.

Let's cache everything we've done so far with the `.cache()` method.

You can wrap code inside an `async` function and it pass to `.cache()`. The first time this code is being run, SDA will fetch and do the necessary computations before writting the results into the `.sda-cache` folder.

Here, I set the `cacheVerbose` option to `true` when instanciating the `SimpleDB` to log cache related information the terminal.

```ts showLineNumbers filename="main.ts" {7, 20} /{ cacheVerbose: true }/
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);
});

await temperatures.logTable();

await sdb.done();
```

Here's the result on the first run.

As indicated in the terminal, SDA didn't find anything in cache for the code on lines 8 to 19, so it ran everything and it took 1 sec, 441 ms with my internet connection and computer. `.sda-cache` has been created and data is now cached in it.

![A screenshot showing data being cached.](/assets/simple-data-analysis/tabular-data/nothing-in-cache.png)

When I save `main.ts` again (`CMD` + `S` on Mac and `CTRL` + `S` on PC), it's different.

SDA checked if the code between lines 8 and 19 has been modified. Since it's exactly the same, it just loads the results of the previous run which are stored in `.sda-cache`.

Instead of 1 sec, 441 ms, runnning the script took only... 32 ms! This 45 times faster! 😱

Here, most of the time saved is on fetching the data. But as we will see in other lessons, you can also cache the results of very heavy computations that take a long time to run.

![A screenshot showing data being retrieved from the cache.](/assets/simple-data-analysis/tabular-data/in-cache.png)

## Exploring the data

To explore the data, we can use the `.summarize()` method. It aggregates the data in the table.

Let's start with `time`. We specify the `categories` as being the values in the column `city` to have the details for each city.

```ts showLineNumbers filename="main.ts" {22-25}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);
});

await temperatures.summarize({
  values: "time",
  categories: "city"
});
await temperatures.logTable();

await sdb.done();
```

The `min` and `max` show that we have over a hundred years worth of daily temperatures for our three cities. It's pretty good to check for trends!

But there is a problem... The `count` columns has different values for each city. In theory, we should have around 44,195 days in 121 years. We see less than that here. It means we will have to deal with missing data...

![A screenshot showing the time values aggregated.](/assets/simple-data-analysis/tabular-data/time.png)
<Callout type="info" emoji="💡">
    If the table layout is displayed weirdly, it's because the width of the table is bigger than the width of your terminal. Do a right click on the terminal and look for `Toggle size with content width`.
</Callout>


Let's now check what we have in `t`, which stands for *temperature*. Just replace `"time"` with `"t"` on line 23.

Hmm... Not only we have missing rows in our data, as we saw just above, we also have some rows with `null` values.

![A screenshot showing the temperature values aggregated.](/assets/simple-data-analysis/tabular-data/t.png)

Let's take care of this right away by using the method `.removeMissing()`. It removes any rows with a `null` value. You can also specify specific columns if you want, but it's not necessary here.

Let's put that in the cache, while we are at it.

```ts showLineNumbers filename="main.ts" {21}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.summarize({
  values: "time",
  categories: "city",
});
await temperatures.logTable();

await sdb.done();
```

Here we go! No more `null` temperatures.

Since we changed the code in the `.cache()` method, you'll notice that the message in the terminal indicates that the code is being run again. Pretty clever, huh? 😉

![A screenshot showing the removeMissing method.](/assets/simple-data-analysis/tabular-data/remove-missing.png)

## Binning the years

One of my go-to resources when I want to analyze data is [climatedate.ca](https://climatedata.ca/). They are a great section about why you should use [30-year averages](https://climatedata.ca/interactive/30-years-data/) when looking for climate trends.

So this is what we are going to do here!

First, let's add a new column with the `time` year. The `.addColumn()` needs three arguments:
- the name of the new column. Here, it's `year`.
- the type of the data in the column. Here, it's `number`.
- the definition of the data in the column. This is an SQL expression (more about it below). We want the year out of `time`.

```ts showLineNumbers filename="main.ts" {24}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.logTable();

await sdb.done();
```
<Callout type="info" emoji="💡">
    `YEAR(time)` is a SQL expression. The [*Structured Query Language*](https://fr.wikipedia.org/wiki/Structured_Query_Language) is a very common language when working with databases. Under the hood, SDA works in SQL. But don't worry, you don't have to be an expert in SQL to use SDA. When you'll need SQL, it will stay very basic, like in the example above and we will learn the basics as we work on lessons and projects.
</Callout>

![A screenshot showing the addColumn method.](/assets/simple-data-analysis/tabular-data/year.png)

Now, we can bin the years with the `.bins()` method. As you may start to understand, there is a method to do pretty much anything you need when analyzing data. 😎

The method needs three arguments:
- The column storing the values
- The interval for the bins
- And the name of the new column storing the bins.

Just to check if everything was done as expected, we can log the result of `await temperatures.getUniques("bin")`, which will return all the unique values in the new column `bin`.

```ts showLineNumbers filename="main.ts" {25, 28}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.logTable();

console.log(await temperatures.getUniques("bin"));

await sdb.done();
```

This is looking great!

![A screenshot showing the bins and getUniques method.](/assets/simple-data-analysis/tabular-data/bins.png)

## Summarizing and filtering the data

Now that we have our daily temperatures binned properly, we can easily compute the average temperature per 30-year for each city.

Let's use our `.summarize()` method again. Bu this time, we will use more options:
- the values are still our temperatures in the `t` column
- there are now two categories. We want to keep the cities and the bins!
- we want the mean and a count of the values for each city and each bin.
- we round the values to two decimals.

Also, the table now has 15 rows, but `.logTable()` just shows the first 10. So we ask it to log 15 to have a better look at the result.

```ts showLineNumbers filename="main.ts" {25, 28}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.summarize({
  values: "t",
  categories: ["city", "bin"],
  summaries: ["mean", "count"],
  decimals: 2,
});
await temperatures.logTable({ nbRowsToLog: 15 });

await sdb.done();
```

This is looking very good. Thanks to the `count`, we can clearly see where data is missing.

Of course, the `"[2020-2049]"` bins are incomplete, but we so is the `[1990-2019]` bin for `MONTREAL`. In theory, the 30-year bins should have 10,957 days.

![A screenshot showing the summary method.](/assets/simple-data-analysis/tabular-data/summary.png)

We could filter out bins that have less than 90% of the expected number of days. So our threshod would be 

To do that, let's use the `.filter()` method, which takes an SQL expression as a condition. As you can see below, it's pretty simple.

```ts showLineNumbers filename="main.ts" {32}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.summarize({
  values: "t",
  categories: ["city", "bin"],
  summaries: ["mean", "count"],
  decimals: 2,
});
await temperatures.filter(`count >= 9861`);
await temperatures.logTable({ nbRowsToLog: 15 });

await sdb.done();
```

We are now left with 11 rows.

![A screenshot showing the filter method.](/assets/simple-data-analysis/tabular-data/filter.png)

## Trends

### Reformatting

Whether we want to visualize the data or statistical indicators to check for trends, we have a problem: our bins are text. It would be way easier to have them as number.

This is what the code below is doing:

- On line 33, we use the `.splitExtract()` method to split the bins on their `-` character, then we pick the first one (index `0`) and put it in a new column `startYear`
- On line 34, we trim the leftover `[`
- And finally on line 35, we convert the values in the column to `number`

By the way, you can always hover over the methods to see their documentation and example. I took the time to document each one of them.

```ts showLineNumbers filename="main.ts" {33-35}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.summarize({
  values: "t",
  categories: ["city", "bin"],
  summaries: ["mean", "count"],
  decimals: 2,
});
await temperatures.filter(`count >= 9861`);
await temperatures.splitExtract("bin", "-", 0, "startYear");
await temperatures.trim("startYear", { character: "[" });
await temperatures.convert({ startYear: "number" });
await temperatures.logTable({ nbRowsToLog: 15 });

await sdb.done();
```
![A screenshot showing how to clean strings.](/assets/simple-data-analysis/tabular-data/cleaning.png)

### Visualization in the terminal

We can now easily visualize our data!

With SDA, you can create basic charts in your terminal. Here, we use `.logDotChart()` and we can clearly see how temperatures have increased in the previous century.

```ts showLineNumbers filename="main.ts" {38}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.summarize({
  values: "t",
  categories: ["city", "bin"],
  summaries: ["mean", "count"],
  decimals: 2,
});
await temperatures.filter(`count >= 9861`);
await temperatures.splitExtract("bin", "-", 0, "startYear");
await temperatures.trim("startYear", { character: "[" });
await temperatures.convert({ startYear: "number" });
await temperatures.logTable({ nbRowsToLog: 15 });

await temperatures.logDotChart("startYear", "mean", { smallMultiples: "city" });

await sdb.done();
```
![A screenshot showing how to log charts in the terminal.](/assets/simple-data-analysis/tabular-data/dot-charts.png)

### Visualization with Plot

Visualizations in the terminal are quite limited. If you want to create fancier charts, you can use [Observable Plot](https://github.com/observablehq/plot), which you have installed when setting up with [setup-sda](https://jsr.io/@nshiab/setup-sda).

We will do a full lesson on Plot later on. It might seem complicated right now, but once you get the basics, it's an amazing data visualization library.

In the example below, we write a chart as a PNG file in our `./sda/output` folder.

```ts showLineNumbers filename="main.ts" {39-72}
import { SimpleDB } from "@nshiab/simple-data-analysis";
import { dot, line, plot } from "@observablehq/plot";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.summarize({
  values: "t",
  categories: ["city", "bin"],
  summaries: ["mean", "count"],
  decimals: 2,
});
await temperatures.filter(`count >= 9861`);
await temperatures.splitExtract("bin", "-", 0, "startYear");
await temperatures.trim("startYear", { character: "[" });
await temperatures.convert({ startYear: "number" });
await temperatures.logTable({ nbRowsToLog: 15 });

const chart = (data: unknown[]) =>
  plot({
    inset: 20,
    marginLeft: 50,
    marginBottom: 40,
    grid: true,
    y: { tickFormat: (d) => `${d}°C`, label: "Temperature", ticks: 5 },
    x: {
      tickFormat: (d) => `${d}-${d + 29}`,
      ticks: [1900, 1930, 1960, 1990],
      label: "Year",
    },
    color: { legend: true },
    marks: [
      line(data, {
        x: "startYear",
        y: "mean",
        stroke: "city",
        curve: "natural",
      }),
      dot(data, {
        x: "startYear",
        y: "mean",
        fill: "white",
        stroke: "city",
        strokeWidth: 2,
        r: 4,
      }),
    ],
  });
await temperatures.writeChart(
  chart,
  "./sda/output/temperatures.png",
);

await sdb.done();
```
![A screenshot showing how to write charts with Plot.](/assets/simple-data-analysis/tabular-data/plot.png)
<Callout type="info" emoji="💡">
    You can open all kind of files with VS Code, including images. Since we are watching `main.ts`, everytime we update the code creating the chart, `temperatures.png` gets rewritten and updated in its tab. Another trick: you can grab the tab `temperatures.png` and put it whenever you want, including on a second screen if you have one.
</Callout>

### Correlations and linear regressions

Now, visualizations are great but their interpretation can be quite subjective.

For trends, you can also rely on statistical indicators like correlations and linear regressions. If you want to know more about it, check the lesson [**Math for journalists**](/ninja-moves/math-for-journalists)

Let's start with correlations. Note that I removed the code to make the chart.

Like `.summarize()`, the method `.correlations` replace the data in the table with the result of its computations.

```ts showLineNumbers filename="main.ts" {37-41}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.summarize({
  values: "t",
  categories: ["city", "bin"],
  summaries: ["mean", "count"],
  decimals: 2,
});
await temperatures.filter(`count >= 9861`);
await temperatures.splitExtract("bin", "-", 0, "startYear");
await temperatures.trim("startYear", { character: "[" });
await temperatures.convert({ startYear: "number" });

await temperatures.correlations({
  x: "startYear",
  y: "mean",
  categories: "city",
});
await temperatures.logTable({ nbRowsToLog: 15 });

await sdb.done();
```

As we can see, the correlations are close to 1, meaning there is strong relationship between the years and the temperature. When one goes up, the other goes up too.

![A screenshot showing how to compute correlations.](/assets/simple-data-analysis/tabular-data/correlation.png)

We can also compute linear regressions, which are more descriptive. Just replace the `.correlations` method by `.linearRegressions` on line 37, and add the option `decimals: 2` to round the values on line 41.

Again, the r<sup>2</sup> is close to 1, meaning the two variables are related. And the slope also tells us than the temperature increased by 0.02°C each year on average.

These three Canadian cities are warming up! 🌡️🌡️🌡️

![A screenshot showing how to compute linear regressions.](/assets/simple-data-analysis/tabular-data/linear-regressions.png)

## Writing data

So the sake of the lesson, let's write our results to a file. With the `.writeData()` method, you can save CSV, JSON and Parquet files. If you are working with big files, you have options available to compress them.

```ts showLineNumbers filename="main.ts" {45}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.summarize({
  values: "t",
  categories: ["city", "bin"],
  summaries: ["mean", "count"],
  decimals: 2,
});
await temperatures.filter(`count >= 9861`);
await temperatures.splitExtract("bin", "-", 0, "startYear");
await temperatures.trim("startYear", { character: "[" });
await temperatures.convert({ startYear: "number" });

await temperatures.linearRegressions({
  x: "startYear",
  y: "mean",
  categories: "city",
  decimals: 2,
});
await temperatures.logTable({ nbRowsToLog: 15 });

await temperatures.writeData("./sda/output/temperatures.csv");

await sdb.done();
```

## Conclusion

Well, that was quite an adventure! This is your first SDA project!

I hope you see the value of the library. With easy to use methods, you can produce complex analysis.

For now, we worked with two small files, but the library is also extremely performant. Wait till we crunch your first 1 billion rows file. 😇 (yeah, this is not a joke, we will really do that in a future project)

But before that, let's dive into the next lesson about geospatial data. That's another strengh of SDA: you can use it with geometries, coordinates and maps too! 🌎

<NoticeEnd />