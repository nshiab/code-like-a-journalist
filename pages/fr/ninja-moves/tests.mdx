---
title: Utiliser des tests dans vos projets
description: Dans cette le√ßon, nous apprenons √† impl√©menter et utiliser des tests dans notre code.
---

import { NoticeIntro, NoticeEnd } from "../../../components/Notices.jsx"

# Utiliser des tests dans vos projets

Les tests sont largement utilis√©s en programmation pour s‚Äôassurer que les classes, fonctions et m√©thodes se comportent comme pr√©vu. Quand le code est mis √† jour, les tests garantissent aussi que les changements n‚Äôont pas touch√© tout le travail effectu√© auparavant.

Mais les tests peuvent aussi √™tre tr√®s utiles dans les projets d‚Äôanalyse de donn√©es et de visualisation. Vous pouvez les utiliser pour vous assurer que vos calculs correspondent √† une r√©f√©rence ind√©pendante. Ou, une fois que vous avez des r√©sultats, pour v√©rifier que vos modifications n‚Äôont pas un impact inattendu sur vos conclusions ou vos visuels.

Personnellement, j‚Äôutilise les tests pour renforcer ma confiance dans mon travail. Je peux v√©rifier quelque chose une fois et √©crire un test pour le valider. Par la suite, je saurai avec certitude que ce r√©sultat est garanti. Et si le test √©choue, cela signifie qu‚Äôun probl√®me s√©rieux s‚Äôest produit et n√©cessite mon attention‚ÄØ!

Dans cette le√ßon, nous allons coder une fonction simple pour calculer des pourcentages et cr√©er des tests pour nous assurer qu‚Äôelle fonctionne comme pr√©vu.

<NoticeIntro lang="fr" />

## Configuration

Nous allons utiliser Deno et VS Code dans cette le√ßon. Cr√©ons une structure de fichiers simple.

Cr√©ez un nouveau dossier `helpers` et placez-y le fichier `getPercentage.ts` avec ce code. C‚Äôest la fonction que nous voulons tester. Elle s'attend √† recevoir deux nombres et retourne le pourcentage sous forme de texte.


```ts showLineNumbers filename="helpers/getPercentage.ts"
export default function getPercentage(
    current: number,
    total: number,
): string {
    const percentage = (current / total) * 100;
    return `${percentage}%`;
}
```

Cr√©ez maintenant un fichier `main.ts` et utilisez la fonction.


```ts showLineNumbers filename="main.ts"
import getPercentage from "./helpers/getPercentage.ts";

console.log(getPercentage(50, 100));
```

√Ä partir de l√†, vous pouvez ex√©cuter le script avec `deno main.ts`.

Tout fonctionne comme pr√©vu ! La fonction retourne `50%`.

![Un script principal affichant une valeur dans le terminal.](/assets/ninja-moves/tests/setup.png)

## Cr√©er des tests

Est-ce que notre fonction fonctionne vraiment comme pr√©vu ? V√©rifions !

D‚Äôabord, installez la librairie standard [@std/assert](https://jsr.io/@std/assert) avec la commande : `deno add jsr:@std/assert`. Nous allons l‚Äôutiliser pour comparer les valeurs retourn√©es par notre fonction avec celles que nous attendons.

Cr√©ons maintenant le fichier de test. Une bonne mani√®re d‚Äôorganiser les tests dans un projet est de garder la m√™me structure de fichiers que le reste du code.

Ici, on pourrait cr√©er un nouveau dossier `tests` avec un fichier `getPercentage.test.ts` √† l‚Äôint√©rieur. Remarquez que ce fichier est un fichier TypeScript classique puisqu‚Äôil se termine par `.ts`. Mais comme on a ajout√© `.test` juste avant l‚Äôextension, Deno sait qu‚Äôil s‚Äôagit d‚Äôun test.

Voici ce que fait le code ci-dessous :
- `Deno.test` cr√©e un nouveau test.
- Le premier param√®tre est une description du test.
- Le second param√®tre est une fonction. On y ex√©cute ce que l‚Äôon veut tester (ici `getPercentage`) et on v√©rifie que le r√©sultat est bien celui attendu avec `assertEquals`.
- Si le r√©sultat est celui attendu, le test r√©ussira. Sinon, il √©chouera !


```ts showLineNumbers filename="tests/getPercentage.test.ts"
import { assertEquals } from "@std/assert";
import getPercentage from "../helpers/getPercentage.ts";

Deno.test("should return 50% for 50 out of 100", () => {
  const result = getPercentage(50, 100);
  assertEquals(result, "50%");
});
```

## Ex√©cuter les tests

Pour lancer les tests avec Deno, il suffit d‚Äôex√©cuter `deno test`. Deno va chercher tous les fichiers `.test.ts` dans le projet et les ex√©cuter.

Vous pouvez aussi ex√©cuter un seul fichier de test si vous le souhaitez. Par exemple, ici ce serait `deno test tests/getPercentage.test.ts`.

Si vous devez r√©cup√©rer des donn√©es sur Internet, ou lire/√©crire des fichiers, n‚Äôoubliez pas de passer les permissions appropri√©es. Pour tout autoriser, vous pouvez utiliser cette commande : `deno test -A`.

![Ex√©cution des tests avec Deno.](/assets/ninja-moves/tests/run-tests.png)

Cependant, ce n‚Äôest pas tr√®s pratique de relancer cette commande √† chaque fois que vous mettez votre code √† jour. Comme on l‚Äôa vu dans d‚Äôautres le√ßons, il vaut mieux surveiller les fichiers et relancer les tests automatiquement.

Pour cela, vous pouvez utiliser l‚Äôoption *watch* : `deno test --watch`. Ex√©cutez cette commande et laissez-la tourner pour le reste de la le√ßon.

Il existe de nombreuses autres options, expliqu√©es [dans la documentation](https://docs.deno.com/runtime/fundamentals/testing/). Une autre que j‚Äôutilise souvent est `--fail-fast`, qui arr√™te tous les tests d√®s qu‚Äôun seul √©choue.

![Surveillance des tests avec Deno.](/assets/ninja-moves/tests/watch-tests.png)

## Ajouter des tests

Selon votre contexte, le test que nous venons d‚Äô√©crire peut √™tre suffisant. Par exemple, peut-√™tre que vous vouliez simplement v√©rifier le r√©sultat d‚Äôune √©tape dans votre analyse de donn√©es et que vous voulez que cela reste comme √ßa √† l‚Äôavenir.

Mais pour les besoins de cette le√ßon, ajoutons quelques tests suppl√©mentaires. Testons des cas limites.

Par exemple, que doit-il se passer si le premier nombre est `0` ? Et si le second est `0` ? Peut-√™tre que nous voulons que notre fonction retourne `0%` dans les deux cas.

Copiez-collez le code ci-dessous. D√®s que vous enregistrerez le fichier modifi√©, les tests se relanceront automatiquement.


```ts showLineNumbers filename="tests/getPercentage.test.ts" {9-17}
import { assertEquals } from "@std/assert";
import getPercentage from "../helpers/getPercentage.ts";

Deno.test("should return 50% for 50 out of 100", () => {
  const result = getPercentage(50, 100);
  assertEquals(result, "50%");
});

Deno.test("should return 0% for 0 out of 100", () => {
  const result = getPercentage(0, 100);
  assertEquals(result, "0%");
});

Deno.test("should return 0% for 1 out of 0", () => {
  const result = getPercentage(1, 0);
  assertEquals(result, "0%");
});
```
![Un test a √©chou√©.](/assets/ninja-moves/tests/fail.png)

On peut voir que le deuxi√®me test est pass√©, mais que le troisi√®me a √©chou√©‚ÄØ!

Quand `total` vaut `0`, notre fonction retourne `Infinity` au lieu de ce que nous voulons, c‚Äôest-√†-dire `0%`.

Mettons √† jour notre fichier `getPercentage.ts` pour corriger cela. Copiez-collez le code ci-dessous. D√®s que vous enregistrerez le fichier, les tests se relanceront automatiquement.


```ts showLineNumbers filename="helpers/getPercentage.ts" {5-7, 10}
export default function getPercentage(
  current: number,
  total: number,
): string {
  if (total === 0) {
    return "0%";
  } else {
    const percentage = (current / total) * 100;
    return `${percentage}%`;
  }
}
```

Et maintenant, on peut voir que le troisi√®me test est pass√©.

On sait aussi que le comportement pr√©c√©dent est toujours l√† puisque les deux premiers tests sont √©galement pass√©s !

![Tous les tests sont pass√©s.](/assets/ninja-moves/tests/all-passed.png)

## Tests automatis√©s

Vous pouvez bien s√ªr toujours lancer les tests localement. Vous pouvez m√™me cr√©er une [t√¢che](/pushing-further/tasks) pour les ex√©cuter plus facilement.

Mais si vous utilisez GitHub, vous pouvez configurer des tests automatis√©s dans vos projets. C‚Äôest une configuration courante pour les librairies en code ouvert, mais vous pouvez l‚Äôutiliser pour n‚Äôimporte quel projet.

Par exemple, j‚Äôai des centaines de tests en place pour la [librairie Simple Data Analysis](https://github.com/nshiab/simple-data-analysis). Vous pouvez [les explorer ici](https://github.com/nshiab/simple-data-analysis/tree/main/test/unit/methods).

J‚Äôutilise GitHub Actions (consultez [la le√ßon √† ce sujet](/git-and-github/github-actions)) pour les d√©clencher automatiquement lorsqu‚Äôune *pull request* est cr√©√©e pour fusionner du nouveau code dans la branche `main`.

Si les tests passent, la fusion est autoris√©e et la nouvelle version de la librairie peut √™tre publi√©e. Mais si un ou plusieurs tests √©chouent, cela signifie qu‚Äôil y a une modification incompatible ou un comportement inattendu, et la PR est rejet√©e. Du travail est encore n√©cessaire. Vous pouvez consulter [le *workflow* ici](https://github.com/nshiab/simple-data-analysis/blob/main/.github/workflows/all-tests.yml).

Ce ne sont que quelques lignes de code, mais cela garantit que la librairie fonctionne comme pr√©vu. Et √ßa m‚Äôa √©vit√© plusieurs fois de publier une nouvelle version cass√©e de la librairie ! üòá

## Tester des visualisations

Les tests sont faciles √† mettre en place lorsque votre code **retourne** quelque chose comme un texte, un nombre, une date, une liste ou un objet.

Mais vous pouvez aussi utiliser des tests pour comparer des √©l√©ments d‚Äôune page web, comme des graphiques, et plus encore, avec [Playwright](https://playwright.dev/). Nous avons utilis√© Playwright dans la [le√ßon sur le web scraping](/web-scraping), mais √† la base, il a √©t√© cr√©√© pour faire des tests !

La [documentation](https://playwright.dev/docs/intro) est tr√®s bien faite. Il y a m√™me une section sur la [comparaison automatique de visuels avec des captures d‚Äô√©cran](https://playwright.dev/docs/test-snapshots).

## Conclusion

Vous n‚Äôavez pas toujours besoin de tests, mais d√®s que vous travaillez sur un projet √† long terme ou complexe, prendre le temps d‚Äô√©crire de simples tests √† chaque fois que vous cr√©ez une nouvelle m√©thode ou fonction peut s‚Äôav√©rer √™tre un excellent investissement.

Vous aurez plus confiance en votre code et, entre le typage et les tests, vous √©viterez beaucoup de vilains bugs et erreurs ! üêû

Et si jamais vous avez un bug √† corriger, ajouter un test pour le couvrir garantira qu‚Äôil ne reviendra jamais !

Bonnes s√©ances de test ! üë∑

<NoticeEnd lang="fr" />