---
title: Utiliser des tests dans vos projets
description: Dans cette leÃ§on, nous apprenons Ã  implÃ©menter et utiliser des tests dans notre code.
---

import { NoticeIntro, NoticeEnd } from "../../../components/Notices.jsx"

# Utiliser des tests dans vos projets

Les tests sont largement utilisÃ©s en programmation pour sâ€™assurer que les classes, fonctions et mÃ©thodes se comportent comme prÃ©vu. Quand le code est mis Ã  jour, les tests garantissent aussi que les changements nâ€™ont pas touchÃ© tout le travail effectuÃ© auparavant.

Mais les tests peuvent aussi Ãªtre trÃ¨s utiles dans les projets dâ€™analyse de donnÃ©es et de visualisation. Vous pouvez les utiliser pour vous assurer que vos calculs correspondent Ã  une rÃ©fÃ©rence indÃ©pendante. Ou, une fois que vous avez des rÃ©sultats, pour vÃ©rifier que vos modifications nâ€™ont pas un impact inattendu sur vos conclusions ou vos visuels.

Personnellement, jâ€™utilise les tests pour renforcer ma confiance dans mon travail. Je peux vÃ©rifier quelque chose une fois et Ã©crire un test pour le valider. Par la suite, je saurai avec certitude que ce rÃ©sultat est garanti. Et si le test Ã©choue, cela signifie quâ€™un problÃ¨me sÃ©rieux sâ€™est produit et nÃ©cessite mon attentionâ€¯!

Dans cette leÃ§on, nous allons coder une fonction simple pour calculer des pourcentages et crÃ©er des tests pour nous assurer quâ€™elle fonctionne comme prÃ©vu.

<NoticeIntro lang="fr" />

## Configuration

Nous allons utiliser Deno et VS Code dans cette leÃ§on. CrÃ©ons une structure de fichiers simple.

CrÃ©ez un nouveau dossier `helpers` et placez-y le fichier `getPercentage.ts` avec ce code. Câ€™est la fonction que nous voulons tester. Elle s'attend Ã  recevoir deux nombres et retourne le pourcentage sous forme de texte.


```ts showLineNumbers filename="helpers/getPercentage.ts"
export default function getPercentage(
    current: number,
    total: number,
): string {
    const percentage = (current / total) * 100;
    return `${percentage}%`;
}
```

CrÃ©ez maintenant un fichier `main.ts` et utilisez la fonction.


```ts showLineNumbers filename="main.ts"
import getPercentage from "./helpers/getPercentage.ts";

console.log(getPercentage(50, 100));
```

Ã€ partir de lÃ , vous pouvez exÃ©cuter le script avec `deno main.ts`.

Tout fonctionne comme prÃ©vu ! La fonction retourne `50%`.

![Un script principal affichant une valeur dans le terminal.](/assets/ninja-moves/tests/setup.png)

## CrÃ©er des tests

Est-ce que notre fonction fonctionne vraiment comme prÃ©vu ? VÃ©rifions !

Dâ€™abord, installez la librairie standard [@std/assert](https://jsr.io/@std/assert) avec la commande : `deno add jsr:@std/assert`. Nous allons lâ€™utiliser pour comparer les valeurs retournÃ©es par notre fonction avec celles que nous attendons.

CrÃ©ons maintenant le fichier de test. Une bonne maniÃ¨re dâ€™organiser les tests dans un projet est de garder la mÃªme structure de fichiers que le reste du code.

Ici, on pourrait crÃ©er un nouveau dossier `tests` avec un fichier `getPercentage.test.ts` Ã  lâ€™intÃ©rieur. Remarquez que ce fichier est un fichier TypeScript classique puisquâ€™il se termine par `.ts`. Mais comme on a ajoutÃ© `.test` juste avant lâ€™extension, Deno sait quâ€™il sâ€™agit dâ€™un test.

Voici ce que fait le code ci-dessous :
- `Deno.test` crÃ©e un nouveau test.
- Le premier paramÃ¨tre est une description du test.
- Le second paramÃ¨tre est une fonction. On y exÃ©cute ce que lâ€™on veut tester (ici `getPercentage`) et on vÃ©rifie que le rÃ©sultat est bien celui attendu avec `assertEquals`.
- Si le rÃ©sultat est celui attendu, le test rÃ©ussira. Sinon, il Ã©chouera !


```ts showLineNumbers filename="tests/getPercentage.test.ts"
import { assertEquals } from "@std/assert";
import getPercentage from "../helpers/getPercentage.ts";

Deno.test("should return 50% for 50 out of 100", () => {
  const result = getPercentage(50, 100);
  assertEquals(result, "50%");
});
```

## ExÃ©cuter les tests

Pour lancer les tests avec Deno, il suffit dâ€™exÃ©cuter `deno test`. Deno va chercher tous les fichiers `.test.ts` dans le projet et les exÃ©cuter.

Vous pouvez aussi exÃ©cuter un seul fichier de test si vous le souhaitez. Par exemple, ici ce serait `deno test tests/getPercentage.test.ts`.

Si vous devez rÃ©cupÃ©rer des donnÃ©es sur Internet, ou lire/Ã©crire des fichiers, nâ€™oubliez pas de passer les permissions appropriÃ©es. Pour tout autoriser, vous pouvez utiliser cette commande : `deno test -A`.

![ExÃ©cution des tests avec Deno.](/assets/ninja-moves/tests/run-tests.png)

Cependant, ce nâ€™est pas trÃ¨s pratique de relancer cette commande Ã  chaque fois que vous mettez votre code Ã  jour. Comme on lâ€™a vu dans dâ€™autres leÃ§ons, il vaut mieux surveiller les fichiers et relancer les tests automatiquement.

Pour cela, vous pouvez utiliser lâ€™option *watch* : `deno test --watch`. ExÃ©cutez cette commande et laissez-la tourner pour le reste de la leÃ§on.

Il existe de nombreuses autres options, expliquÃ©es [dans la documentation](https://docs.deno.com/runtime/fundamentals/testing/). Une autre que jâ€™utilise souvent est `--fail-fast`, qui arrÃªte tous les tests dÃ¨s quâ€™un seul Ã©choue.

![Surveillance des tests avec Deno.](/assets/ninja-moves/tests/watch-tests.png)

## Ajouter des tests

Selon votre contexte, le test que nous venons dâ€™Ã©crire peut Ãªtre suffisant. Par exemple, peut-Ãªtre que vous vouliez simplement vÃ©rifier le rÃ©sultat dâ€™une Ã©tape dans votre analyse de donnÃ©es et que vous voulez que cela reste comme Ã§a Ã  lâ€™avenir.

Mais pour les besoins de cette leÃ§on, ajoutons quelques tests supplÃ©mentaires. Testons des cas limites.

Par exemple, que doit-il se passer si le premier nombre est `0` ? Et si le second est `0` ? Peut-Ãªtre que nous voulons que notre fonction retourne `0%` dans les deux cas.

Copiez-collez le code ci-dessous. DÃ¨s que vous enregistrerez le fichier modifiÃ©, les tests se relanceront automatiquement.


```ts showLineNumbers filename="tests/getPercentage.test.ts" {9-17}
import { assertEquals } from "@std/assert";
import getPercentage from "../helpers/getPercentage.ts";

Deno.test("should return 50% for 50 out of 100", () => {
  const result = getPercentage(50, 100);
  assertEquals(result, "50%");
});

Deno.test("should return 0% for 0 out of 100", () => {
  const result = getPercentage(0, 100);
  assertEquals(result, "0%");
});

Deno.test("should return 0% for 1 out of 0", () => {
  const result = getPercentage(1, 0);
  assertEquals(result, "0%");
});
```
![Un test a Ã©chouÃ©.](/assets/ninja-moves/tests/fail.png)

On peut voir que le deuxiÃ¨me test est passÃ©, mais que le troisiÃ¨me a Ã©chouÃ©â€¯!

Quand `total` vaut `0`, notre fonction retourne `Infinity` au lieu de ce que nous voulons, câ€™est-Ã -dire `0%`.

Mettons Ã  jour notre fichier `getPercentage.ts` pour corriger cela. Copiez-collez le code ci-dessous. DÃ¨s que vous enregistrerez le fichier, les tests se relanceront automatiquement.


```ts showLineNumbers filename="helpers/getPercentage.ts" {5-7, 10}
export default function getPercentage(
  current: number,
  total: number,
): string {
  if (total === 0) {
    return "0%";
  } else {
    const percentage = (current / total) * 100;
    return `${percentage}%`;
  }
}
```

Et maintenant, on peut voir que le troisiÃ¨me test est passÃ©.

On sait aussi que le comportement prÃ©cÃ©dent est toujours lÃ  puisque les deux premiers tests sont Ã©galement passÃ©s !

![Tous les tests sont passÃ©s.](/assets/ninja-moves/tests/all-passed.png)

## Tests automatisÃ©s

Vous pouvez bien sÃ»r toujours lancer les tests localement. Vous pouvez mÃªme crÃ©er une [tÃ¢che](/pushing-further/tasks) pour les exÃ©cuter plus facilement.

Mais si vous utilisez GitHub, vous pouvez configurer des tests automatisÃ©s dans vos projets. Câ€™est une configuration courante pour les librairies en code ouvert, mais vous pouvez lâ€™utiliser pour nâ€™importe quel projet.

Par exemple, jâ€™ai des centaines de tests en place pour la [librairie Simple Data Analysis](https://github.com/nshiab/simple-data-analysis). Vous pouvez [les explorer ici](https://github.com/nshiab/simple-data-analysis/tree/main/test/unit/methods).

Jâ€™utilise GitHub Actions (consultez [la leÃ§on Ã  ce sujet](/git-and-github/github-actions)) pour les dÃ©clencher automatiquement lorsquâ€™une *pull request* est crÃ©Ã©e pour fusionner du nouveau code dans la branche `main`.

Si les tests passent, la fusion est autorisÃ©e et la nouvelle version de la librairie peut Ãªtre publiÃ©e. Mais si un ou plusieurs tests Ã©chouent, cela signifie quâ€™il y a une modification incompatible ou un comportement inattendu, et la PR est rejetÃ©e. Du travail est encore nÃ©cessaire. Vous pouvez consulter [le *workflow* ici](https://github.com/nshiab/simple-data-analysis/blob/main/.github/workflows/all-tests.yml).

Ce ne sont que quelques lignes de code, mais cela garantit que la librairie fonctionne comme prÃ©vu. Et Ã§a mâ€™a Ã©vitÃ© plusieurs fois de publier une nouvelle version cassÃ©e de la librairie ! ğŸ˜‡

## Tester des visualisations

Les tests sont faciles Ã  mettre en place lorsque votre code **retourne** quelque chose comme un texte, un nombre, une date, une liste ou un objet.

Mais vous pouvez aussi utiliser des tests pour comparer des Ã©lÃ©ments dâ€™une page web, comme des graphiques, et plus encore, avec [Playwright](https://playwright.dev/). Nous avons utilisÃ© Playwright dans la [leÃ§on sur le web scraping](/web-scraping), mais Ã  la base, il a Ã©tÃ© crÃ©Ã© pour faire des tests !

La [documentation](https://playwright.dev/docs/intro) est trÃ¨s bien faite. Il y a mÃªme une section sur la [comparaison automatique de visuels avec des captures dâ€™Ã©cran](https://playwright.dev/docs/test-snapshots).

## Conclusion

Vous nâ€™avez pas toujours besoin de tests, mais dÃ¨s que vous travaillez sur un projet Ã  long terme ou complexe, prendre le temps dâ€™Ã©crire de simples tests Ã  chaque fois que vous crÃ©ez une nouvelle mÃ©thode ou fonction peut sâ€™avÃ©rer Ãªtre un excellent investissement.

Vous aurez plus confiance en votre code et, entre le typage et les tests, vous Ã©viterez beaucoup de vilains bugs et erreurs ! ğŸ

Et si jamais vous avez un bug Ã  corriger, ajouter un test pour le couvrir garantira quâ€™il ne reviendra jamais !

Bonnes sÃ©ances de test ! ğŸ‘·

<NoticeEnd lang="fr" />