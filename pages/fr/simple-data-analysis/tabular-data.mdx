---
title: Comment analyser des donn√©es tabulaires avec la librairie simple-data-analysis
description: Dans cette le√ßon, nous apprenons √† utiliser SDA en traitant des donn√©es historiques de temp√©rature.
---

import { Callout } from 'nextra/components'
import { NoticeIntro, NoticeEnd } from "../../../components/Notices.jsx"
import YouTube from "../../../components/YouTube.jsx"

# La librairie Simple Data Analysis

<YouTube videoId="cFfVROAcHAU" lang="fr" />

Dans cette le√ßon, nous allons apprendre √† utiliser la librairie en code ouvert que j'ai cr√©√©e : [simple-data-analysis](https://github.com/nshiab/simple-data-analysis). Nous analyserons des donn√©es historiques de temp√©rature moyenne quotidienne dans trois villes canadiennes √† titre d'exemple. Notre objectif sera de r√©pondre √† cette question :

- √Ä quelle vitesse les temp√©ratures ont-elles augment√© ces derni√®res d√©cennies ?

Pour ce faire, nous calculerons la temp√©rature moyenne par p√©riode de 30 ans et examinerons les tendances.

Si vous avez une minute, ajoutez un ‚≠ê √† la [page GitHub](https://github.com/nshiab/simple-data-analysis) de la librairie. C'est toujours agr√©able de savoir que son travail en code ouvert est appr√©ci√©. üòä

Notez que je m'attends √† ce que vous ayez au moins compl√©t√© les sections **Premiers pas üßë‚Äçüéì** et **Aller plus loin üöÄ**.


<NoticeIntro lang="fr" />

## Installation

La librairie est publi√©e sur [JSR](https://jsr.io/@nshiab/simple-data-analysis), et vous pouvez l'installer en ex√©cutant `deno add @nshiab/simple-data-analysis`.

Mais il y a une meilleure fa√ßon. üòè

Cr√©ez un nouveau dossier sur votre ordinateur et ex√©cutez plut√¥t cette commande : `deno -A jsr:@nshiab/setup-sda`

Cela indique √† Deno d'ex√©cuter une autre librairie appel√©e [setup-sda](https://jsr.io/@nshiab/setup-sda), que j'ai √©galement cr√©√©e pour installer et configurer facilement tout ce dont vous avez besoin pour d√©marrer une nouvelle analyse de donn√©es.

Apr√®s avoir ex√©cut√© la commande, votre terminal affichera une description des fichiers cr√©√©s et des librairies install√©es.

![Capture d'√©cran montrant VS Code apr√®s l'ex√©cution de setup-sda.](/assets/simple-data-analysis/tabular-data/setup.png)
<Callout type="info" emoji="üí°">
  Pour que SDA fonctionne correctement, il est recommand√© d'avoir au moins la version 2.1.9 de Deno. Pour v√©rifier votre version, vous pouvez ex√©cuter `deno --version` dans votre terminal. Pour la mettre √† jour, il suffit d'ex√©cuter `deno upgrade`.
</Callout>

### Fichiers cr√©√©s

- `deno.json` : Si vous l'ouvrez, vous verrez deux t√¢ches. Nous utiliserons `sda` pour surveiller, v√©rifier et ex√©cuter `sda/main.ts`. Vous verrez √©galement trois librairies list√©es. Plus d‚Äôinformations ci-dessous.
- `.gitignore` : Un fichier important lors de l'utilisation de `git` pour sauvegarder notre code. Ne vous en souciez pas pour l‚Äôinstant ; il y aura une le√ßon compl√®te √† ce sujet.
- `sda/main.ts` : Le fichier principal de notre script. C'est ici que nous √©crirons notre code.
- `sda/helpers` : Un dossier vide pour le moment, mais vous pourrez l‚Äôutiliser pour vos fonctions.
- `sda/data` : Un dossier vide pour le moment, mais c‚Äôest ici que nous stockerons nos donn√©es pour l‚Äôanalyse.
- `sda/output` : Un dossier vide pour le moment. C'est ici que nous √©crirons nos r√©sultats dans des fichiers.
- `README.md` : Un fichier texte contenant quelques informations sur le projet, que vous pouvez modifier comme bon vous semble.

### Librairies install√©es

- [`simple-data-analysis`](https://github.com/nshiab/simple-data-analysis) : La librairie que nous utiliserons pour traiter les donn√©es.
- [`journalism`](https://github.com/nshiab/journalism) : Une autre librairie que j‚Äôai cr√©√©e. Elle contient des fonctions utiles pour diverses t√¢ches, comme le formatage des dates ou l'envoi de donn√©es vers Google Sheets.
- [`@observablehq/plot`](https://github.com/observablehq/plot) : Une librairie cr√©√©e par Mike Bostock (cr√©ateur de d3.js) que nous utiliserons pour cr√©er des graphiques et des cartes.

Maintenant que vous savez ce qu‚Äôil y a dans votre dossier, passons au travail. Ex√©cutez la t√¢che sugg√©r√©e pour ex√©cuter et surveiller notre code : `deno task sda`

## Cr√©ation d'une table

Laissez-moi vous expliquer le code actuel dans `./sda/main.ts`.

Lorsque vous utilisez SDA, vous cr√©ez une **base de donn√©es en m√©moire**. C'est ce qui se passe √† la ligne 3 avec `const sdb = new SimpleDB()`. Une fois nos calculs termin√©s, nous fermons la base de donn√©es √† la ligne 7 avec `await sdb.done()`.


```ts showLineNumbers filename="main.ts"
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB();

// Do your magic here!

await sdb.done();
```

Comme dans une base de donn√©es classique, avec SimpleDB, les donn√©es sont stock√©es dans des **tables**. Si vous √™tes plus familier avec Excel ou Google Sheets, les tables peuvent √™tre comprises comme des onglets.

Cr√©ons-en une pour stocker les temp√©ratures quotidiennes.

Pour cr√©er une table, vous pouvez utiliser la m√©thode `.newTable()`. Vous pouvez lui donner un nom (bien que ce soit optionnel) et stocker la table dans une variable. En g√©n√©ral, je nomme la variable et la table de la m√™me fa√ßon.


```ts showLineNumbers filename="main.ts" {5}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB();

const temperatures = sdb.newTable("temperatures");

await sdb.done();
```

Maintenant que nous avons une table, nous pouvons utiliser les m√©thodes de la table ! Sur une nouvelle ligne, tapez la variable `temperature` (qui fait maintenant r√©f√©rence √† la table) et ajoutez un `.` imm√©diatement apr√®s pour voir toutes les m√©thodes disponibles. Vous pouvez utiliser les fl√®ches haut et bas de votre clavier pour consulter leur documentation et leurs exemples. Il y en a beaucoup !

Toutes les m√©thodes document√©es avec des exemples sont √©galement [disponibles sur JSR](https://jsr.io/@nshiab/simple-data-analysis/doc).

Dans la capture d‚Äô√©cran ci-dessous, je me suis arr√™t√© sur `loadData`, qui est la m√©thode que nous allons utiliser dans un instant.

![Capture d‚Äô√©cran montrant la documentation de VS Code pour loadData.](/assets/simple-data-analysis/tabular-data/load-data-doc.png)

## Chargement des donn√©es

J‚Äôai t√©l√©vers√© les temp√©ratures quotidiennes historiques de trois villes canadiennes sur GitHub. C'est un fichier CSV que [vous pouvez voir ici](https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv). Il provient des [Donn√©es climatiques canadiennes ajust√©es et homog√©n√©is√©es](https://www.canada.ca/en/environment-climate-change/services/climate-change/science-research-data/climate-trends-variability/adjusted-homogenized-canadian-data.html) d'Environnement Canada.

Utilisons la m√©thode `loadData` pour le r√©cup√©rer. Notez que cette m√©thode peut aussi bien r√©cup√©rer des fichiers distants que lire des fichiers locaux. Elle peut charger des fichiers CSV, JSON, Excel et Parquet. Plut√¥t pratique !

Ce serait int√©ressant de voir les donn√©es une fois charg√©es. Nous pouvons le faire en appelant la m√©thode `logTable`.

Toutes les m√©thodes des tables sont `async`, nous devons donc sp√©cifier `await` devant elles.


```ts showLineNumbers filename="main.ts" {7-9, 11}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB();

const temperatures = sdb.newTable("temperatures");

await temperatures.loadData(
  "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
);

await temperatures.logTable();

await sdb.done();
```

Et voici le r√©sultat ! Nous pouvons voir que les donn√©es du fichier CSV ont √©t√© int√©gr√©es dans la table `temperature`, qui contient d√©sormais trois colonnes et 131¬†192 lignes.

![Capture d‚Äô√©cran montrant les donn√©es de temp√©rature enregistr√©es dans le terminal.](/assets/simple-data-analysis/tabular-data/data-loaded.png)

## Assembler des tables

Ce serait mieux de remplacer les identifiants (`id`) par les noms des villes. Les identifiants et les noms des villes se trouvent dans un autre fichier que [j‚Äôai √©galement t√©l√©vers√© sur GitHub](https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv).

Allons le r√©cup√©rer aussi.


```ts showLineNumbers filename="main.ts" {11-15}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB();

const temperatures = sdb.newTable("temperatures");
await temperatures.loadData(
  "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
);
await temperatures.logTable();

const cities = sdb.newTable("cities");
await cities.loadData(
  "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
);
await cities.logTable();

await sdb.done();
```

![Capture d‚Äô√©cran montrant les noms des villes dans le terminal.](/assets/simple-data-analysis/tabular-data/cities-loaded.png)

Maintenant, nous voulons int√©grer les noms des villes dans la table `temperature`. Pour cela, nous pouvons utiliser la m√©thode `.join()`.

Par d√©faut, cette m√©thode recherche une colonne commune dans deux tables et associe les lignes en fonction des valeurs de cette colonne.

Ainsi, lorsque nous √©crivons `await temperature.join(cities)`, nous demandons √† SDA de trouver une colonne commune (qui est `id`) dans `temperature` et `cities`, puis d'ajouter les valeurs de `cities` correspondant au m√™me `id` aux lignes correspondantes dans `temperature`.

Notez que j‚Äôai mis en commentaire les appels pr√©c√©dents √† `logTable` aux lignes 9 et 15 pour √©viter de surcharger le terminal.


```ts showLineNumbers filename="main.ts" {17-18}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB();

const temperatures = sdb.newTable("temperatures");
await temperatures.loadData(
  "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
);
// await temperatures.logTable();

const cities = sdb.newTable("cities");
await cities.loadData(
  "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
);
// await cities.logTable();

await temperatures.join(cities);
await temperatures.logTable();

await sdb.done();
```

Et maintenant, nous avons les noms des villes dans la table `temperature` !

![Capture d‚Äô√©cran montrant les noms des villes dans la table temperature.](/assets/simple-data-analysis/tabular-data/join.png)

## Mise en cache

Actuellement, √† chaque fois que nous enregistrons `main.ts`, les deux fichiers CSV sont t√©l√©charg√©s √† nouveau √† partir de GitHub. Cela est lent et inutile puisque les donn√©es ne changent pas.

Mettons tout ce que nous avons fait jusqu‚Äô√† pr√©sent en cache avec la m√©thode `.cache()`.

Vous pouvez encapsuler votre code dans une fonction `async` et la passer √† `.cache()`. La premi√®re fois que ce code s‚Äôex√©cute, SDA r√©cup√©rera les donn√©es et effectuera les calculs n√©cessaires avant d‚Äô√©crire les r√©sultats dans le dossier `.sda-cache`.

Ici, j‚Äôai d√©fini l‚Äôoption `cacheVerbose` √† `true` lors de l‚Äôinstanciation de `SimpleDB` afin d'afficher les informations li√©es au cache dans le terminal.


```ts showLineNumbers filename="main.ts" {7, 20} /{ cacheVerbose: true }/
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);
});

await temperatures.logTable();

await sdb.done();
```

Voici le r√©sultat lors de la premi√®re ex√©cution.

Comme indiqu√© dans le terminal, SDA n‚Äôa rien trouv√© en cache pour le code entre les lignes 8 et 19, donc il a tout ex√©cut√©. Cela a pris 1 sec, 441 ms avec ma connexion Internet et mon ordinateur. Le dossier `.sda-cache` a √©t√© cr√©√©, et les donn√©es y sont maintenant mises en cache.

![Capture d‚Äô√©cran montrant les donn√©es mises en cache.](/assets/simple-data-analysis/tabular-data/nothing-in-cache.png)

Quand j‚Äôenregistre `main.ts` √† nouveau (`CMD` + `S` sur Mac et `CTRL` + `S` sur PC), le comportement change.

SDA v√©rifie si le code entre les lignes 8 et 19 a √©t√© modifi√©. Comme il est exactement le m√™me, SDA charge simplement les r√©sultats de l‚Äôex√©cution pr√©c√©dente stock√©s dans `.sda-cache`.

Au lieu de 1 sec, 441 ms, l‚Äôex√©cution du script n‚Äôa pris que... 32 ms ! C'est 45 fois plus rapide ! üò±

Ici, la majeure partie du temps gagn√© provient de la r√©cup√©ration des donn√©es qui se fait par le Web. Mais comme nous le verrons dans d‚Äôautres le√ßons, vous pouvez √©galement mettre en cache les r√©sultats de calculs lourds qui prennent du temps √† s‚Äôex√©cuter, ce qui peut am√©liorer consid√©rablement votre productivit√©.

![Capture d‚Äô√©cran montrant les donn√©es r√©cup√©r√©es depuis le cache.](/assets/simple-data-analysis/tabular-data/in-cache.png)

<Callout type="info" emoji="üí°">
    Lorsque vous utilisez la m√©thode `.cache()`, il est tr√®s important d‚Äôappeler `await sdb.done()` √† la fin de votre script. Entre autres, cette m√©thode supprime les donn√©es en cache non utilis√©es √† chaque ex√©cution. Sans cela, le cache pourrait devenir tr√®s volumineux. Et si vous voulez nettoyer votre cache manuellement, ex√©cutez simplement `deno task clean`.
</Callout>

## Explorer les donn√©es

Pour explorer les donn√©es, nous pouvons utiliser la m√©thode `.summarize()`. Elle agr√®ge les donn√©es contenues dans la table.

Commen√ßons par `time`. Nous sp√©cifions `categories` comme √©tant les valeurs de la colonne `city` pour voir les d√©tails pour chaque ville.

```ts showLineNumbers filename="main.ts" {22-25}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);
});

await temperatures.summarize({
  values: "time",
  categories: "city"
});
await temperatures.logTable();

await sdb.done();
```

Les valeurs `min` et `max` montrent que nous avons plus d‚Äôun si√®cle de temp√©ratures quotidiennes pour nos trois villes. C‚Äôest plut√¥t bien pour analyser les tendances !

Mais il y a un probl√®me... La colonne `count` affiche des valeurs diff√©rentes pour chaque ville. Th√©oriquement, nous devrions avoir environ 44 195 jours en 121 ans. Nous en voyons moins ici, ce qui signifie que nous allons devoir g√©rer des donn√©es manquantes...

![Capture d‚Äô√©cran montrant les valeurs agr√©g√©es de time.](/assets/simple-data-analysis/tabular-data/time.png)

<Callout type="info" emoji="üí°">
    Si l'affichage de la table semble √©trange dans votre terminal, c'est parce que la largeur de la table est plus grande que celle de votre terminal. Faites un clic droit sur le terminal et cherchez `Toggle size with content width`. Il existe aussi un raccourci tr√®s pratique que j‚Äôutilise tout le temps pour cela : `OPTION` + `Z` sur Mac et `ALT` + `Z` sur PC.
</Callout>

Voyons maintenant ce que nous avons dans `t`, qui repr√©sente la *temp√©rature*. Il suffit de remplacer `"time"` par `"t"` √† la ligne 23.

Hmm... Non seulement nous avons des lignes manquantes dans nos donn√©es, comme nous l‚Äôavons vu juste au-dessus, mais nous avons aussi certaines lignes avec des valeurs `null`.

![Capture d‚Äô√©cran montrant les valeurs agr√©g√©es de t.](/assets/simple-data-analysis/tabular-data/t.png)

Occupons-nous de ce probl√®me imm√©diatement en utilisant la m√©thode `.removeMissing()`. Elle supprime toutes les lignes contenant une valeur `null`. Vous pouvez aussi sp√©cifier des colonnes pr√©cises si n√©cessaire, mais ce n'est pas utile ici.

Profitons-en pour mettre cela en cache en m√™me temps.


```ts showLineNumbers filename="main.ts" {21}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.summarize({
  values: "time",
  categories: "city",
});
await temperatures.logTable();

await sdb.done();
```

Et voil√† ! Plus aucune temp√©rature `null`.

Comme nous avons modifi√© le code dans la m√©thode `.cache()`, vous remarquerez que le message dans le terminal indique que le code est ex√©cut√© √† nouveau. Plut√¥t malin, non ? üòâ

![Capture d‚Äô√©cran montrant la m√©thode removeMissing en action.](/assets/simple-data-analysis/tabular-data/remove-missing.png)

## Regrouper les ann√©es en intervalles

L'une de mes ressources pr√©f√©r√©es lorsque j'analyse des donn√©es climatiques est [climatedata.ca](https://climatedata.ca/). Ils ont une excellente section expliquant pourquoi il est important d'utiliser des [moyennes sur 30 ans](https://climatedata.ca/interactive/30-years-data/) pour identifier des tendances climatiques.

C‚Äôest exactement ce que nous allons faire ici !

Tout d‚Äôabord, ajoutons une nouvelle colonne avec l‚Äôann√©e extraite de `time`. La m√©thode `.addColumn()` n√©cessite trois arguments :
- Le nom de la nouvelle colonne. Ici, c‚Äôest `year`.
- Le type de donn√©es dans la colonne. Ici, c‚Äôest `number`.
- La d√©finition des donn√©es dans la colonne. Il s‚Äôagit d‚Äôune expression SQL (nous y reviendrons plus tard). Nous voulons extraire l‚Äôann√©e de `time`.


```ts showLineNumbers filename="main.ts" {24}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.logTable();

await sdb.done();
```
<Callout type="info" emoji="üí°">
    `YEAR(time)` est une expression SQL. Le [*Structured Query Language*](https://fr.wikipedia.org/wiki/Structured_Query_Language) est un langage tr√®s r√©pandu lorsqu'on travaille avec des bases de donn√©es. En interne, SDA fonctionne avec SQL. Mais ne vous inqui√©tez pas, vous n‚Äôavez pas besoin d‚Äô√™tre un expert en SQL pour utiliser SDA. Lorsque nous en aurons besoin, il s'agira d'expressions tr√®s simples, comme dans l'exemple ci-dessus, et nous apprendrons les bases au fur et √† mesure des le√ßons et projets.
</Callout>

![Capture d‚Äô√©cran montrant la m√©thode addColumn en action.](/assets/simple-data-analysis/tabular-data/year.png)

Maintenant, nous pouvons regrouper les ann√©es en intervalles avec la m√©thode `.bins()`. Comme vous commencez √† le comprendre, SDA propose une m√©thode pour presque tout ce dont vous avez besoin lors de l'analyse de donn√©es. üòé

Cette m√©thode n√©cessite trois arguments :
- La colonne contenant les valeurs √† regrouper
- L‚Äôintervalle des groupes
- Le nom de la nouvelle colonne contenant les groupes

Pour v√©rifier que tout a √©t√© fait correctement, nous pouvons afficher le r√©sultat de `await temperature.getUniques("bin")`, qui retournera toutes les valeurs uniques dans la nouvelle colonne `bin`.


```ts showLineNumbers filename="main.ts" {25, 28}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.logTable();

console.log(await temperatures.getUniques("bin"));

await sdb.done();
```

C'est parfait !

![Capture d‚Äô√©cran montrant les m√©thodes bins et getUniques en action.](/assets/simple-data-analysis/tabular-data/bins.png)

## R√©sumer et filtrer les donn√©es

Maintenant que nos temp√©ratures quotidiennes sont bien regroup√©es en intervalles, nous pouvons facilement calculer la temp√©rature moyenne par p√©riode de 30 ans pour chaque ville.

Utilisons √† nouveau la m√©thode `.summarize()`. Mais cette fois, nous allons utiliser plus d'options :
- Les valeurs restent nos temp√©ratures dans la colonne `t`.
- Il y a maintenant deux cat√©gories : nous voulons conserver les villes et les intervalles.
- Nous voulons calculer la moyenne et compter le nombre de valeurs pour chaque ville et chaque intervalle.
- Nous arrondissons les valeurs √† deux d√©cimales.

De plus, la table contient maintenant 15 lignes, mais `.logTable()` n'affiche que les 10 premi√®res. Nous allons donc lui demander d'en afficher 15 pour mieux voir le r√©sultat.


```ts showLineNumbers filename="main.ts" {26-31} /{ nbRowsToLog: 15 }/
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.summarize({
  values: "t",
  categories: ["city", "bin"],
  summaries: ["mean", "count"],
  decimals: 2,
});
await temperatures.logTable({ nbRowsToLog: 15 });

await sdb.done();
```

Voil√† qui est int√©ressant... Gr√¢ce √† la colonne `count`, nous pouvons clairement voir o√π il manque des donn√©es.

Bien s√ªr, les intervalles `[2020-2049]` sont incomplets, mais l‚Äôintervalle `[1990-2019]` l‚Äôest aussi pour `MONTREAL`. Th√©oriquement, chaque intervalle de 30 ans devrait contenir environ 10 957 jours.

![Capture d‚Äô√©cran montrant la m√©thode summary en action.](/assets/simple-data-analysis/tabular-data/summary.png)

Nous pourrions exclure les intervalles qui ont moins de 90 % du nombre de jours attendu. Notre seuil serait donc de 9 861 jours.

Pour cela, utilisons la m√©thode `.filter()`, qui prend une expression SQL comme condition. Comme vous pouvez le voir ci-dessous, c‚Äôest tr√®s simple.


```ts showLineNumbers filename="main.ts" {32}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.summarize({
  values: "t",
  categories: ["city", "bin"],
  summaries: ["mean", "count"],
  decimals: 2,
});
await temperatures.filter(`count >= 9861`);
await temperatures.logTable({ nbRowsToLog: 15 });

await sdb.done();
```
<Callout type="info" emoji="üí°">
    Vous n'√™tes pas oblig√© d'utiliser des *backticks* pour les expressions SQL, comme je l‚Äôai fait aux lignes 24 et 32. Les m√©thodes attendent simplement du texte. J‚Äôai pris cette habitude parce que les *template literals* sont pratiques pour injecter des variables dans du texte, et c‚Äôest quelque chose que nous ferons souvent avec les expressions SQL, comme nous le verrons dans les prochaines le√ßons et projets.
</Callout>

Nous avons maintenant 11 lignes restantes.

![Capture d‚Äô√©cran montrant la m√©thode filter en action.](/assets/simple-data-analysis/tabular-data/filter.png)

## Tendances

### Reformater les donn√©es

Que nous souhaitions visualiser les donn√©es ou calculer des indicateurs statistiques pour analyser les tendances, nous avons un probl√®me : nos intervalles sont du texte. Il serait bien plus simple de les avoir sous forme de nombres.

Le code ci-dessous r√©sout ce probl√®me :

- √Ä la ligne 33, nous utilisons la m√©thode `.splitExtract()` pour diviser les intervalles sur le caract√®re `-`, puis nous prenons la premi√®re partie (index `0`) et l'ajoutons dans une nouvelle colonne `startYear`.
- √Ä la ligne 34, nous supprimons le `[` restant.
- Enfin, √† la ligne 35, nous convertissons les valeurs de la colonne `startYear` en `number`.

Petit astuce: vous pouvez toujours survoler les m√©thodes avec votre curseur pour voir leur documentation et des exemples. J‚Äôai pris le temps de documenter chacune d‚Äôelles. ü´°


```ts showLineNumbers filename="main.ts" {33-35}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.summarize({
  values: "t",
  categories: ["city", "bin"],
  summaries: ["mean", "count"],
  decimals: 2,
});
await temperatures.filter(`count >= 9861`);
await temperatures.splitExtract("bin", "-", 0, "startYear");
await temperatures.trim("startYear", { character: "[" });
await temperatures.convert({ startYear: "number" });
await temperatures.logTable({ nbRowsToLog: 15 });

await sdb.done();
```
![Capture d‚Äô√©cran montrant comment nettoyer les cha√Ænes de caract√®res.](/assets/simple-data-analysis/tabular-data/cleaning.png)

### Visualisation dans le terminal

Nous pouvons maintenant facilement visualiser nos donn√©es !

Avec SDA, vous pouvez cr√©er des graphiques de base directement dans votre terminal. Ici, nous utilisons `.logDotChart()`, et nous pouvons clairement voir comment les temp√©ratures ont augment√© au cours du si√®cle dernier.


```ts showLineNumbers filename="main.ts" {38}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.summarize({
  values: "t",
  categories: ["city", "bin"],
  summaries: ["mean", "count"],
  decimals: 2,
});
await temperatures.filter(`count >= 9861`);
await temperatures.splitExtract("bin", "-", 0, "startYear");
await temperatures.trim("startYear", { character: "[" });
await temperatures.convert({ startYear: "number" });
await temperatures.logTable({ nbRowsToLog: 15 });

await temperatures.logDotChart("startYear", "mean", { smallMultiples: "city" });

await sdb.done();
```
![Capture d‚Äô√©cran montrant comment afficher des graphiques dans le terminal.](/assets/simple-data-analysis/tabular-data/dot-charts.png)

### Visualisation avec Plot

Les visualisations dans le terminal sont assez limit√©es. Si vous voulez cr√©er des graphiques plus √©labor√©s, vous pouvez utiliser [Observable Plot](https://github.com/observablehq/plot), qui a √©t√© install√© lors de la configuration avec [setup-sda](https://jsr.io/@nshiab/setup-sda).

Nous ferons une le√ßon compl√®te sur Plot plus tard. Cela peut sembler compliqu√© pour l‚Äôinstant, mais une fois que vous aurez assimil√© les bases, vous verrez que c'est une librairie de visualisation de donn√©es exceptionnelle.

Dans l‚Äôexemple ci-dessous, nous √©crivons un graphique sous forme de fichier PNG dans notre dossier `./sda/output`.


```ts showLineNumbers filename="main.ts" {39-72}
import { SimpleDB } from "@nshiab/simple-data-analysis";
import { dot, line, plot } from "@observablehq/plot";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.summarize({
  values: "t",
  categories: ["city", "bin"],
  summaries: ["mean", "count"],
  decimals: 2,
});
await temperatures.filter(`count >= 9861`);
await temperatures.splitExtract("bin", "-", 0, "startYear");
await temperatures.trim("startYear", { character: "[" });
await temperatures.convert({ startYear: "number" });
await temperatures.logTable({ nbRowsToLog: 15 });

const chart = (data: unknown[]) =>
  plot({
    inset: 20,
    marginLeft: 50,
    marginBottom: 40,
    grid: true,
    y: { tickFormat: (d) => `${d}¬∞C`, label: "Temperature", ticks: 5 },
    x: {
      tickFormat: (d) => `${d}-${d + 29}`,
      ticks: [1900, 1930, 1960, 1990],
      label: "Year",
    },
    color: { legend: true },
    marks: [
      line(data, {
        x: "startYear",
        y: "mean",
        stroke: "city",
        curve: "natural",
      }),
      dot(data, {
        x: "startYear",
        y: "mean",
        fill: "white",
        stroke: "city",
        strokeWidth: 2,
        r: 4,
      }),
    ],
  });
await temperatures.writeChart(
  chart,
  "./sda/output/temperatures.png",
);

await sdb.done();
```
![Capture d‚Äô√©cran montrant comment g√©n√©rer des graphiques avec Plot.](/assets/simple-data-analysis/tabular-data/plot.png)

<Callout type="info" emoji="üí°">
    Vous pouvez ouvrir toutes sortes de fichiers avec VS Code, y compris les images. Comme nous surveillons `main.ts`, chaque fois que nous mettons √† jour le code g√©n√©rant le graphique, `temperatures.png` est r√©√©crit et mis √† jour dans son onglet. Autre astuce : vous pouvez d√©placer l‚Äôonglet `temperatures.png` o√π vous le souhaitez, y compris sur un deuxi√®me √©cran si vous en avez un.
</Callout>

### Corr√©lations et r√©gressions lin√©aires

Les visualisations sont utiles, mais leur interpr√©tation peut √™tre subjective.

Pour analyser les tendances, vous pouvez aussi vous appuyer sur des indicateurs statistiques comme les corr√©lations et les r√©gressions lin√©aires. Si vous souhaitez en savoir plus sur ces concepts, consultez la le√ßon [**Maths pour les journalistes**](/ninja-moves/math-for-journalists).

Commen√ßons par les corr√©lations. Notez que j‚Äôai supprim√© le code g√©n√©rant le graphique.

Comme `.summarize()`, la m√©thode `.correlations()` remplace les donn√©es de la table par les r√©sultats de ses calculs.

```ts showLineNumbers filename="main.ts" {37-41}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.summarize({
  values: "t",
  categories: ["city", "bin"],
  summaries: ["mean", "count"],
  decimals: 2,
});
await temperatures.filter(`count >= 9861`);
await temperatures.splitExtract("bin", "-", 0, "startYear");
await temperatures.trim("startYear", { character: "[" });
await temperatures.convert({ startYear: "number" });

await temperatures.correlations({
  x: "startYear",
  y: "mean",
  categories: "city",
});
await temperatures.logTable({ nbRowsToLog: 15 });

await sdb.done();
```

Comme nous pouvons le voir, les corr√©lations sont proches de 1, ce qui signifie qu'il existe une forte relation entre les ann√©es et la temp√©rature. Quand l'une augmente, l'autre aussi.

![Capture d‚Äô√©cran montrant comment calculer les corr√©lations.](/assets/simple-data-analysis/tabular-data/correlation.png)

Nous pouvons √©galement calculer des r√©gressions lin√©aires, qui sont plus descriptives. Il suffit de remplacer la m√©thode `.correlations` par `.linearRegressions` √† la ligne 37 et d'ajouter l'option `decimals: 2` pour arrondir les valeurs √† la ligne 41.

Encore une fois, le r<sup>2</sup> est proche de 1, ce qui signifie que les deux variables sont li√©es. La *slope* nous indique aussi que la temp√©rature a augment√© de 0,02¬∞C par an en moyenne.

Ces trois villes canadiennes se sont r√©chauff√©es ! üå°Ô∏èüå°Ô∏èüå°Ô∏è

![Capture d‚Äô√©cran montrant comment calculer les r√©gressions lin√©aires.](/assets/simple-data-analysis/tabular-data/linear-regressions.png)

## √âcriture des donn√©es

Pour finir en beaut√©, √©crivons nos r√©sultats dans un fichier. Avec la m√©thode `.writeData()`, vous pouvez enregistrer des fichiers au format CSV, JSON et Parquet. Si vous travaillez avec de gros fichiers, des options sont disponibles pour les compresser.


```ts showLineNumbers filename="main.ts" {45}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.addColumn("year", "number", `YEAR(time)`);
await temperatures.bins("year", 30, "bin");
await temperatures.summarize({
  values: "t",
  categories: ["city", "bin"],
  summaries: ["mean", "count"],
  decimals: 2,
});
await temperatures.filter(`count >= 9861`);
await temperatures.splitExtract("bin", "-", 0, "startYear");
await temperatures.trim("startYear", { character: "[" });
await temperatures.convert({ startYear: "number" });

await temperatures.linearRegressions({
  x: "startYear",
  y: "mean",
  categories: "city",
  decimals: 2,
});
await temperatures.logTable({ nbRowsToLog: 15 });

await temperatures.writeData("./sda/output/temperatures.csv");

await sdb.done();
```

## Conclusion

Eh bien, quelle aventure ! üéâ C'√©tait votre premier projet avec SDA !

J'esp√®re que vous voyez l'int√©r√™t de cette librairie. Avec ses m√©thodes simples √† utiliser, vous pouvez r√©aliser des analyses complexes.

Jusqu‚Äô√† pr√©sent, nous avons travaill√© avec deux petits fichiers, mais la librairie est aussi extr√™mement performante. Attendez de traiter votre premier fichier d‚Äôun milliard de lignes. üòá (Oui, ce n‚Äôest pas une blague‚Äînous allons vraiment le faire dans un futur projet.)

Mais avant cela, passons √† la prochaine le√ßon sur les donn√©es g√©ospatiales. C'est une autre force de SDA : vous pouvez aussi l‚Äôutiliser avec des g√©om√©tries, des coordonn√©es et des cartes ! üåé


<NoticeEnd lang="fr"/>
