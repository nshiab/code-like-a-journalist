---
title: How to analysize tabular data with the simple-data-analysis library
description: In this lesson, we learn how to use SDA by crunching daily temperature data.
---

import { Callout } from 'nextra/components'
import { NoticeIntro, NoticeEnd } from "../../../components/Notices.jsx"

# The Simple Data Analysis library

In this lesson, we will learn how to use the open-source library I created: [simple-data-analysis](https://github.com/nshiab/simple-data-analysis). We will analyze historical daily temperature data in three Canadian cities as an example. Our goal will be to answer this question:

- How fast have the temperture risen in the past decades?

To do that, we will calculate the average temperature per decade and check for trends.

If you have a minute, please add a ⭐ to the library [GitHub repository](https://github.com/nshiab/simple-data-analysis). It's always nice to know your open-source work is appreciated. 😊

Note that I am expecting you have at least completed the **First steps 🧑‍🎓** and **Pushing further 🚀** sections.

<NoticeIntro />

## Setup

The library is published on [JSR](https://jsr.io/@nshiab/simple-data-analysis) and you could install it by running `deno add @nshiab/simple-data-analysis`.

But there's a better way. 😏

Create a new folder on your computer and run this instead:
`deno -A jsr:@nshiab/setup-sda`

This tells Deno to run the another library called [setup-sda](https://jsr.io/@nshiab/setup-sda), which I created too to easily install and setup everything I need when starting a new data analysis.

Here's what you should see in VS Code.

In your terminal, you have a description of the files that have been created and the libraries that have been installed.

![A screenshot showing VS Code after running setup-sda.](/assets/simple-data-analysis/tabular-data/setup.png)

Here are the files:

- `deno.json`: if you click on it, you'll see two taks. We will use `sda` to watch, check and run `sda/main.ts` You can also see three libraries. More about it below.
- `.gitignore`: this is an important file when using `git` to save our code. Don't worry about it for now. There will be a full lesson about it.
- `sda/main.ts`: this is the main file of our script. We will code in it.
- `sda/helpers`: it's an empty folder for now, but we will put our functions in it.
- `sda/data`: it's an empty folder for now, but this is where we will put our data to be crunched.
- `sda/output`: it's an empty folder for now. This is where will write our results into files.
- `README.md`: it's a text file with some information about the project.

And here are three libraries installed:
- [`simple-data-analysis`](https://github.com/nshiab/simple-data-analysis): it's the library we will use to crunch the data.
- [`journalism`](https://github.com/nshiab/journalism): it's another library I created. It's a collection of useful functions to do all kind of things, like formatting dates or pushing data to Google Sheets.
- [`@observablehq/plot`](https://github.com/observablehq/plot): It's a library created by Mike Bostock (creator of d3.js) that we will use to create charts and maps.

Now that you know what's in your folder, let's start working. Run the suggested task to run and watch our code: `deno task sda`

## Creating a table

Let me explain the current code in `main.ts`.

When you use SDA, you create an **in-memory database**. This is what is happening on line 3 with `new SimpleDB()`. When we are done with our computations, we close the DB on line 7.

```ts showLineNumbers filename="main.ts"
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB();

// Do your magic here!

await sdb.done();
```

As in a regular database, with SimpleDB, data is stored into **tables**. If you are more familiar with Excel or Google Sheets, tables can be understood are tabs.

Let's create one to store daily temperatures.

To create a table, you can use the `.newTable()` method. You can give it a name (but it's optional) and store the table in a variable. Usually, I name the variable and the table the same thing.

```ts showLineNumbers filename="main.ts" {5}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB();

const temperatures = sdb.newTable("temperatures");

await sdb.done();
```

Now that we have a table, we can use tables' methods! On another line, type the variable `temperature` and add a `.` immediately after it to see all the methods available. You can use your up and down keyboard arrow to check their documentation and examples. There's a lot!

In the screenshot below, I stopped on `loadData`, which the method we are going to use in a minute.

![A screenshot showing VS Code documentation for loadData.](/assets/simple-data-analysis/tabular-data/load-data-doc.png)

## Loading data

I uploaded to GitHub the historical daily temperatures for three Canadian cities. It's a CSV file that [you can see here](https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv).

Let's use the `loadData` method to retrieve it. Note that the method is able to fetch remote files but also to read local files. It can parse CSV, JSON, Excel, and Parquet files. Quite handy!

It would be nice to see the data once loaded. We can do that by calling the `logTable` method.

All tables' methods are `async`, so we need to specify `await` in front of them.

```ts showLineNumbers filename="main.ts" {7-9, 11}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB();

const temperatures = sdb.newTable("temperatures");

await temperatures.loadData(
  "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
);

await temperatures.logTable();

await sdb.done();
```

And here's the result! We can see the CSV data has been ingested into the table `temperature` which now has three columns and 131k rows.

![A screenshot showing temperature data logged in the terminal.](/assets/simple-data-analysis/tabular-data/data-loaded.png)

## Joining data

It would be better to replace the ids by the cities names. The ids and the city names are in another file that [I uploaded on GitHub too](https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv).

Let's fetch it too.

```ts showLineNumbers filename="main.ts" {11-15}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB();

const temperatures = sdb.newTable("temperatures");
await temperatures.loadData(
  "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
);
await temperatures.logTable();

const cities = sdb.newTable("cities");
await cities.loadData(
  "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
);
await cities.logTable();

await sdb.done();
```

![A screenshot showing the cities names in the terminal.](/assets/simple-data-analysis/tabular-data/cities-loaded.png)

Now, we want to bring the cities names into the the `temperatures` table. To do that, we can use the `.join()` method.

By default, this methods will look for a common column in two tables and will match rows based on the values in this column.

So, when we write `await temperature.join(cities)`, we ask SDA to find a common column in `temperatures` and `cities` (which is `id`) and to add to the `temperature` rows the `cities` values with the same `id`.

```ts showLineNumbers filename="main.ts" {9, 15, 17-18}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB();

const temperatures = sdb.newTable("temperatures");
await temperatures.loadData(
  "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
);
// await temperatures.logTable();

const cities = sdb.newTable("cities");
await cities.loadData(
  "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
);
// await cities.logTable();

await temperatures.join(cities);
await temperatures.logTable();

await sdb.done();
```

And now we have the cities names into the `temperatures` table!

![A screenshot showing the cities names in the temperatures table.](/assets/simple-data-analysis/tabular-data/join.png)

## Caching

Curently, everytime we save `main.ts`, the two CSV files are being refetched. It's slow and unecessary since the data doesn't change.

Let's cache everything we've done so far with the `.cache()` method.

You can wrap code inside an `async` function and it pass to `.cache()`. The first time this code is being run, SDA will fetch and do the necessary computations before writting the results into the `.sda-cache` folder.

Here, I set the `cacheVerbose` option to `true` when instanciating the `SimpleDB` to log cache related information the terminal.

```ts showLineNumbers filename="main.ts" {7, 20} /{ cacheVerbose: true }/
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);
});

await temperatures.logTable();

await sdb.done();
```

Here's the result on the first run.

As indicated in the terminal, SDA didn't find anything in cache for the code on lines 8 to 19, so it ran everything and it took 1 sec, 441 ms with my internet connection and computer. `.sda-cache` has been created and data is now cached in it.

![A screenshot showing data being cached.](/assets/simple-data-analysis/tabular-data/nothing-in-cache.png)

When I save `main.ts` again (`CMD` + `S` on Mac and `CTRL` + `S` on PC), it's different.

SDA checked if the code between lines 8 and 19 has been modified. Since it's exactly the same, it just loads the results of the previous run which are stored in `.sda-cache`.

Instead of 1 sec, 441 ms, runnning the script took only... 32 ms! This 45 times faster! 😱

Here, most of the time saved is on fetching the data. But as we will see in other lessons, you can also cache the results of very heavy computations that take a long time to run.

![A screenshot showing data being retrieved from the cache.](/assets/simple-data-analysis/tabular-data/in-cache.png)

## Exploring the data

To explore the data, we can use the `.summarize()` method. It aggregates the data in the table.

Let's start with `time`. We specify the `categories` as being the values in the column `city` to have the details for each city.

```ts showLineNumbers filename="main.ts" {22-25}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);
});

await temperatures.summarize({
  values: "time",
  categories: "city"
});
await temperatures.logTable();

await sdb.done();
```

The `min` and `max` show that we have over a hundred years worth of daily temperatures for our three cities. It's pretty good to check for trends!

But there is a problem... The `count` columns has different values for each city. In theory, we should have around 44,195 days in 121 years. We see less than that here. It means we will have to deal with missing data...

![A screenshot showing the time values aggregated.](/assets/simple-data-analysis/tabular-data/time.png)
<Callout type="info" emoji="💡">
    If the table layout is displayed weirdly, it's because the width of the table is bigger than the width of your terminal. Do a right click on the terminal and look for `Toggle size with content width`.
</Callout>


Let's now check what we have in `t`, which stands for *temperature*. Just replace `"time"` with `"t"` on line 23.

Hmm... Not only we have missing rows in our data, as we saw just above, we also have some rows with `null` values.

![A screenshot showing the temperature values aggregated.](/assets/simple-data-analysis/tabular-data/t.png)

Let's take care of this right away by using the method `.removeMissing()`. It removes any rows with a `null` value. You can also specify specific columns if you want, but it's not necessary here.

Let's put that in the cache, while we are at it.

```ts showLineNumbers filename="main.ts" {21}
import { SimpleDB } from "@nshiab/simple-data-analysis";

const sdb = new SimpleDB({ cacheVerbose: true });

const temperatures = sdb.newTable("temperatures");

await temperatures.cache(async () => {
  await temperatures.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/dailyTemperatures.csv",
  );
  // await temperatures.logTable();

  const cities = sdb.newTable("cities");
  await cities.loadData(
    "https://raw.githubusercontent.com/nshiab/simple-data-analysis/refs/heads/main/test/data/files/cities.csv",
  );
  // await cities.logTable();

  await temperatures.join(cities);

  await temperatures.removeMissing();
});

await temperatures.summarize({
  values: "time",
  categories: "city",
});
await temperatures.logTable();

await sdb.done();
```

Here we go! No more null temperatures.

Since we changed the code in the `.cache()` method, you'll notice that the message in the terminal indicates that the code is being run again. Pretty clever, huh? 😉

![A screenshot showing the removeMissing method.](/assets/simple-data-analysis/tabular-data/remove-missing.png)

<NoticeEnd />