---
title: R√©cup√©rer des donn√©es avec Deno
description: Apprenez √† r√©cup√©rer et sauvegarder des donn√©es avec Deno, y compris les fichiers JSON, CSV et HTML.
---

import { Callout } from 'nextra/components'
import { NoticeIntro, NoticeEnd } from "../../../components/Notices.jsx"
import YouTube from "../../../components/YouTube.jsx"

# R√©cup√©rer des donn√©es

<YouTube videoId="qjXKylGEnqk" lang="fr"/>

Le Web est omnipr√©sent et une source extraordinaire de donn√©es. Dans cette le√ßon, nous explorerons comment r√©cup√©rer et t√©l√©charger des donn√©es.

<NoticeIntro lang="fr"/>

## Configuration

Pr√©parons notre environnement de travail pour cette le√ßon.

Cr√©ez un nouveau dossier quelque part sur votre ordinateur, ouvrez-le avec VS Code, et cr√©ez deux fichiers :

- `main.ts`, o√π nous √©crirons notre code. Pour commencer, vous pouvez ajouter `console.log("Hello!");` dedans.
- `deno.json`, qui permet √† VS Code de savoir qu'il s'agit d'un projet Deno et active l'extension Deno. Vous pouvez ajuster les param√®tres dans ce fichier, mais nous le laisserons vide pour l'instant.

Ouvrez le terminal et ex√©cutez la commande suivante : `deno run --watch --check main.ts`

Cette commande efface le terminal et r√©ex√©cute `main.ts` √† chaque fois que vous le sauvegardez (`CMD` + `S` sur Mac ou `CTRL` + `S` sur PC).

Vous pouvez utiliser cette configuration pour tester le code fourni dans cette le√ßon.

![Une capture d'√©cran montrant VS Code ex√©cutant et surveillant un fichier TypeScript.](/assets/pushing-further/fetch/setup.png)

## R√©cup√©rer un fichier JSON

R√©cup√©rons ce fichier [temp.json](https://raw.githubusercontent.com/nshiab/data-fetch-lesson/refs/heads/main/temp.json). Il contient les temp√©ratures quotidiennes √† Montr√©al de 2000 √† 2020. Je l‚Äôai t√©l√©vers√© sur GitHub sp√©cifiquement pour cette le√ßon.

Si vous l'ouvrez, vous remarquerez qu'il s'agit d'une liste d'objets, chaque objet stockant une date et une temp√©rature.

![Une capture d'√©cran montrant VS Code ex√©cutant et surveillant un fichier TypeScript.](/assets/pushing-further/fetch/json-file.png)

Pour le r√©cup√©rer, vous pouvez utiliser la fonction `fetch()`. Elle est disponible globalement, donc vous pouvez l'appeler directement dans votre code. Elle n√©cessite l'URL correspondante en tant que texte.

```ts showLineNumbers filename="main.ts"
const response = await fetch(
  "https://raw.githubusercontent.com/nshiab/data-fetch-lesson/refs/heads/main/temp.json",
);

console.log(response);
```
<Callout type="info" emoji="üí°">
    `fetch()` est une fonction **asynchrone**, nous devons donc ajouter `await` devant pour nous assurer que notre ordinateur r√©cup√®re les ressources avant d'ex√©cuter les lignes suivantes. Pour plus d'informations, consultez la section *√Ä propos de await* dans la le√ßon [√âcrire et lire des fichiers](/pushing-further/files).
</Callout>

Nous avons un avertissement de s√©curit√©‚ÄØ! Deno nous avertit qu'un script essaie de se connecter √† Internet. ‚ö†Ô∏è

Par d√©faut, Deno bloque tout script qui tente de se connecter au Web, ce qui est une excellente fonctionnalit√©. Imaginez ex√©cuter un code envoy√© par quelqu‚Äôun qui volerait vos informations‚ÄØ!

![Une capture d'√©cran montrant Deno avertissant d'une connexion r√©seau.](/assets/pushing-further/fetch/allow-net.png)

Pour permettre √† votre code de se connecter √† Internet, vous devez ajouter l'option `--allow-net` dans la commande du terminal.

Ainsi, au lieu d‚Äôex√©cuter votre script avec `deno run --watch --check main.ts` comme indiqu√© au d√©but de cette le√ßon, vous devez utiliser `deno run --watch --check --allow-net main.ts`.

Cependant, comme nous allons √©galement √©crire des donn√©es sur notre ordinateur plus tard, utilisons plut√¥t l'option `-A`, qui permet √† notre script de faire tout ce dont il a besoin.

Cliquez sur votre terminal et appuyez sur `CTRL + C` pour arr√™ter l'ex√©cution du script (cela fonctionne sur Mac et PC). Ensuite, ex√©cutez‚ÄØ: `deno run --watch --check -A main.ts`

Et maintenant, √ßa fonctionne‚ÄØ!

![Une capture d'√©cran montrant une r√©ponse fetch affich√©e dans le terminal.](/assets/pushing-further/fetch/response.png)

Wow... Il y a beaucoup d'informations dans cette r√©ponse, et c'est normal. Votre ordinateur et le serveur h√©bergeant le fichier √©changent beaucoup d'informations pour s'assurer que la connexion fonctionne correctement.

Dans notre cas, nous savons que c'est un fichier JSON, nous pouvons donc appeler la m√©thode asynchrone `.json()` pour convertir les donn√©es de la r√©ponse en JSON.

```ts showLineNumbers filename="main.ts"
const response = await fetch(
  "https://raw.githubusercontent.com/nshiab/data-fetch-lesson/refs/heads/main/temp.json",
);

const data = await response.json();

console.log(data);
```

![Une capture d'√©cran montrant un fichier JSON r√©cup√©r√© affich√© dans le terminal.](/assets/pushing-further/fetch/json-data.png)

Et voil√†‚ÄØ! Nous avons r√©cup√©r√© les donn√©es, et nous pouvons maintenant travailler avec elles‚ÄØ!

Au lieu de les r√©cup√©rer √† chaque fois, nous pourrions √©crire les donn√©es dans un fichier pour une utilisation future.

```ts showLineNumbers filename="main.ts"
const response = await fetch(
  "https://raw.githubusercontent.com/nshiab/data-fetch-lesson/refs/heads/main/temp.json",
);

const data = await response.json();

await Deno.writeTextFile("./temp.json", JSON.stringify(data));
```

![Une capture d'√©cran montrant un fichier JSON r√©cup√©r√© √©crit dans un fichier.](/assets/pushing-further/fetch/json-write.png)

F√©licitations‚ÄØ! Vous savez maintenant comment r√©cup√©rer et enregistrer des fichiers JSON. C'√©tait facile, n'est-ce pas‚ÄØ? üòÑ

## R√©cup√©rer un fichier texte/CSV

Au lieu d‚Äôun fichier JSON, vous pourriez vouloir r√©cup√©rer et enregistrer un fichier CSV, qui est un fichier texte brut.

C‚Äôest assez simple‚ÄØ: au lieu d‚Äôappeler `.json()` pour convertir la r√©ponse, utilisez `.text()`.

J‚Äôai t√©l√©vers√© [temp.csv](https://raw.githubusercontent.com/nshiab/data-fetch-lesson/refs/heads/main/temp.csv) sur GitHub pour cette le√ßon.

Voici le code mis √† jour pour le r√©cup√©rer et le sauvegarder. Nous explorerons comment analyser les donn√©es des fichiers CSV dans une autre le√ßon.

```ts showLineNumbers filename="main.ts"
const response = await fetch(
  "https://raw.githubusercontent.com/nshiab/data-fetch-lesson/refs/heads/main/temp.csv",
);

const data = await response.text();

await Deno.writeTextFile("./temp.csv", data);
```
<Callout type="info" emoji="üí°">
    Pour √©crire les donn√©es JSON, nous avons d√ª utiliser `JSON.stringify()` car `writeTextFile` ne peut √©crire que du texte, et les donn√©es JSON √©taient une liste d'objets. Cependant, les donn√©es CSV sont d√©j√† du texte, donc nous pouvons les passer directement √† `writeTextFile`.
</Callout>

![Une capture d'√©cran montrant un fichier CSV r√©cup√©r√© √©crit dans un fichier.](/assets/pushing-further/fetch/csv-write.png)

## R√©cup√©rer le HTML d'une page web

Vous pouvez √©galement r√©cup√©rer le code source d'une page web. Par exemple, voici comment r√©cup√©rer le HTML de la page d'accueil de Codez comme un journaliste.

Nous explorerons comment extraire des donn√©es des pages web (une technique appel√©e *web scraping*) dans une autre le√ßon.

```ts showLineNumbers filename="main.ts"
const response = await fetch(
  "https://www.code-like-a-journalist.com/en",
);

const html = await response.text();

console.log(html);
```

![Une capture d'√©cran montrant le HTML d'une page web r√©cup√©r√© et affich√© dans le terminal.](/assets/pushing-further/fetch/html.png)

## Conclusion

Vous savez maintenant comment r√©cup√©rer et sauvegarder des donn√©es avec Deno.

Mais il y a autre chose d'extr√™mement utile et publi√© sur le Web‚ÄØ: les biblioth√®ques TypeScript. Consultez la prochaine le√ßon pour d√©couvrir ce qu'elles sont‚ÄØ! üëÄ

<NoticeEnd lang="fr"/>